USE Ciudadano
GO
--Alterar la Base de Datos para Agregar un Grupo de Archivos Optimizado para Memoria
ALTER DATABASE CIUDADANO
ADD FILEGROUP CIUDADANOINMEMORY_MOD
CONTAINS MEMORY_OPTIMIZED_DATA
GO
--Agregar un Archivo al Grupo de Archivos Optimizado para Memoria
ALTER DATABASE CIUDADANO
ADD FILE (NAME='CIUDADANOINMEMORY', FILENAME='C:\DATA\CIUDADANOINMEMORY')
TO FILEGROUP CIUDADANOINMEMORY_MOD
GO
-- Obtener los Primeros 100 Registros de la Tabla CIUDADANO
SELECT TOP 100 * FROM CIUDADANO
-- Contar el Número Total de Registros en la Tabla CIUDADANO
SELECT COUNT (*) FROM CIUDADANO
--Crear Tabla Basada en disco
CREATE TABLE [DiskBasedCiudadanoTable]
(
[CODIGO] INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
NOM1 NCHAR (150) NULL,
NOM2 NCHAR (150) NULL,
APE1 NCHAR (200) NULL,
APE2 NCHAR (200) NULL
)
--Tabla basada en memoria
CREATE TABLE [MemoryOptimizedCiudadanoTable]
(
[CODIGO] INT IDENTITY(1,1) NOT NULL PRIMARY KEY NONCLUSTERED HASH WITH (BUCKET_COUNT=50000),
NOM1 NCHAR ( 150) NULL,
NOM2 NCHAR (150) NULL,
APE1 NCHAR ( 200) NULL,
APE2 NCHAR ( 200) NULL
) WITH (MEMORY_OPTIMIZED=ON, DURABILITY = SCHEMA_AND_DATA)
GO
--Inserción de Datos en Tabla Basada en Disco
INSERT INTO DiskBasedCiudadanoTable (NOM1, NOM2, APE1, APE2)
SELECT TOP 1000000 NOM1, NOM2, APE1, APE2 FROM CIUDADANO
GO
--Inserción de Datos en Tabla Optimizada para Memoria
INSERT INTO MemoryOptimizedCiudadanoTable(NOM1, NOM2, APE1, APE2)
SELECT TOP 1000000 NOM1, NOM2, APE1, APE2 FROM CIUDADANO
GO
--Consulta por Código en Tabla Optimizada para Memoria
SELECT NOM1, NOM2, APE1, APE2 FROM MemoryOptimizedCiudadanoTable
WHERE CODIGO=998999
--Consulta por Nombre en Tabla Optimizada para Memoria
SELECT NOM1, NOM2, APE1, APE2 FROM MemoryOptimizedCiudadanoTable
WHERE NOM1='VICTOR'
--Modificar index en la tabla memoria
ALTER TABLE MemoryOptimizedCiudadanoTable 
ADD INDEX IDX_NOMBRE (NOM1, NOM2)
-- Modificar tabla para agregar índice tipo hash
ALTER TABLE MemoryOptimizedCiudadanoTable
ADD INDEX LUX_APELLIDOS HASH (APE1) WITH (BUCKET_COUNT=50000)
--Consulta
SELECT DISTINCT APE1 FROM MemoryOptimizedCiudadanoTable
-- Comando para Crear el Procedimiento Almacenado de Forma Nativa
CREATE PROCEDURE INSERT_TABLAMEMORIA(@NOM1 VARCHAR(150), @NOM2 VARCHAR(150), @APE1 VARCHAR(150), @APE2 VARCHAR(150))
WITH NATIVE_COMPILATION, SCHEMABINDING
AS
BEGIN ATOMIC WITH (TRANSACTION ISOLATION LEVEL=SNAPSHOT, LANGUAGE='ENGLISH')
INSERT INTO BDO.MemoryOptimizedCiudadanoTable(NOM1, NOM2, APE1, APE2)
VALUES (@NOM1, @NOM2, @APE1, @APE2)
END
GO
--Ejecución del Procedimiento Almacenado
EXEC INSERT_TABLAMEMORIA 'JOSE','ARMANDO','DE LEON','PALACIOS'
